{% extends "layout.html" %}

{% block content %}
<div class="glass-panel" style="animation: slideIn 0.3s ease-out;">
    <div class="panel-header" style="margin-bottom: 2rem;">
        <h2 style="font-weight: 700; letter-spacing: -0.5px; display: flex; align-items: center; gap: 0.75rem;">
            <i class="ri-history-line" style="color: var(--primary);"></i> System Logs
        </h2>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">

        <!-- Admin Logs -->
        <div>
            <h3 style="margin-bottom: 1rem; color: var(--text-main); font-size: 1.1rem;">
                <i class="ri-admin-line"></i> Admin Events
            </h3>
            <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Action</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="adminLogsBody">
                        <tr>
                            <td colspan="3" class="text-center text-muted">Loading logs...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VPN Alerts -->
        <div>
            <h3 style="margin-bottom: 1rem; color: var(--danger); font-size: 1.1rem;">
                <i class="ri-alarm-warning-line"></i> VPN Alerts
            </h3>
            <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Target</th>
                            <th>Score</th>
                            <th>Reason</th>
                        </tr>
                    </thead>
                    <tbody id="vpnLogsBody">
                        <tr>
                            <td colspan="4" class="text-center text-muted">Loading alerts...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function fetchLogs() {
        try {
            const res = await fetch('/api/logs');
            const data = await res.json();

            // Render Admin Logs
            const adminBody = document.getElementById('adminLogsBody');
            if (data.admin.length === 0) {
                adminBody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding: 2rem; color: var(--text-muted);">No administrative events recorded.</td></tr>';
            } else {
                adminBody.innerHTML = data.admin.map(l => `
                <tr>
                    <td class="mono" style="font-size: 0.85rem; color: var(--text-muted);">${l.time}</td>
                    <td><span class="badge neutral">${l.action}</span></td>
                    <td>${l.details}</td>
                </tr>
            `).join('');
            }

            // Render VPN Logs
            const vpnBody = document.getElementById('vpnLogsBody');
            if (data.vpn.length === 0) {
                vpnBody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 2rem; color: var(--text-muted);"><i class="ri-shield-check-line" style="font-size: 1.5rem; display:block; margin-bottom:0.5rem;"></i>No VPN threats detected.<br><small>System is monitoring traffic.</small></td></tr>';
            } else {
                vpnBody.innerHTML = data.vpn.map(l => `
                <tr style="border-left: 2px solid var(--danger); background: rgba(239, 68, 68, 0.05);">
                    <td class="mono" style="font-size: 0.85rem;">${l.time}</td>
                    <td class="mono">${l.src_ip}</td>
                    <td><span class="badge" style="background: var(--danger); color: #fff;">${(l.score * 100).toFixed(0)}%</span></td>
                    <td style="color: var(--danger); font-size: 0.9rem;">${l.reason}</td>
                </tr>
            `).join('');
            }

        } catch (e) {
            console.error("Error fetching logs:", e);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchLogs();
        setInterval(fetchLogs, 5000);
    });
</script>
{% endblock %}