{% extends "layout.html" %}

{% block content %}
<div class="bento-grid animate-enter">
  <!-- 1. Total Traffic (Large) -->
  <div class="bento-card span-1" onclick="location.href='{{ url_for('activity_page') }}'" style="cursor: pointer;">
    <div class="card-header">
      <span class="card-title">Total Bandwidth</span>
      <i class="ri-global-line card-icon"></i>
    </div>
    <div class="card-value" id="total-traffic">0.00 MB</div>
    <div class="card-sub">
      <i class="ri-arrow-up-line"></i> <span id="upload-speed">0</span> KB/s
      <span style="color: var(--text-muted); margin: 0 5px;">|</span>
      <i class="ri-arrow-down-line" style="color: var(--primary)"></i> <span id="download-speed"
        style="color: var(--primary)">0</span> KB/s
    </div>
    <!-- Mini Chart Background -->
    <canvas id="miniTrafficChart"
      style="position: absolute; bottom: 0; left: 0; width: 100%; height: 60px; opacity: 0.3;"></canvas>
  </div>

  <!-- 2. Active Devices -->
  <div class="bento-card span-1" onclick="location.href='{{ url_for('devices_page') }}'" style="cursor: pointer;">
    <div class="card-header">
      <span class="card-title">Active Devices</span>
      <i class="ri-smartphone-line card-icon" style="color: var(--secondary)"></i>
    </div>
    <div class="card-value" id="active-devices">0</div>
    <div class="card-sub">
      <span class="badge success">Online</span>
    </div>
  </div>

  <!-- 3. VPN Alerts -->
  <div class="bento-card span-1" onclick="location.href='{{ url_for('vpn_page') }}'" style="cursor: pointer;">
    <div class="card-header">
      <span class="card-title">Threats Detected</span>
      <i class="ri-alarm-warning-line card-icon" style="color: var(--danger)"></i>
    </div>
    <div class="card-value" id="vpn-alerts" style="color: var(--danger)">0</div>
    <div class="card-sub">
      <span class="badge danger">High Risk</span>
    </div>
  </div>

  <!-- 4. Main Traffic Chart (Wide) -->
  <div class="bento-card span-3 row-2">
    <div class="card-header">
      <span class="card-title">Real-time Network Activity</span>
      <div style="display: flex; gap: 10px;">
        <span class="badge primary">Live</span>
      </div>
    </div>
    <div style="height: 220px; width: 100%;">
      <canvas id="trafficChart"></canvas>
    </div>
  </div>

  <!-- 5. Recent Activity Log (Wide) -->
  <div class="bento-card span-3">
    <div class="card-header">
      <span class="card-title">Recent Packets</span>
      <a href="{{ url_for('activity_page') }}"
        style="font-size: 0.8rem; color: var(--primary); text-decoration: none;">View All &rarr;</a>
    </div>
    <div
      style="overflow-x: auto; max-height: 400px; scrollbar-width: thin; scrollbar-color: var(--primary) transparent;">
      <table class="glass-table">
        <thead>
          <tr>
            <th style="position: sticky; top: 0; background: var(--bg-card); backdrop-filter: blur(12px); z-index: 10;">
              Time</th>
            <th style="position: sticky; top: 0; background: var(--bg-card); backdrop-filter: blur(12px); z-index: 10;">
              Source</th>
            <th style="position: sticky; top: 0; background: var(--bg-card); backdrop-filter: blur(12px); z-index: 10;">
              Target</th>
            <th style="position: sticky; top: 0; background: var(--bg-card); backdrop-filter: blur(12px); z-index: 10;">
              Proto</th>
            <th style="position: sticky; top: 0; background: var(--bg-card); backdrop-filter: blur(12px); z-index: 10;">
              Size</th>
          </tr>
        </thead>
        <tbody id="activity-log-body">
          <tr>
            <td colspan="5" style="text-align:center; padding: 2rem; color: var(--text-muted);">
              <i class="ri-loader-4-line ri-spin" style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
              Waiting for live traffic...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}?v=2"></script>
{% endblock %}